<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Metablock | XMPro </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Metablock | XMPro ">
      
      
      <link rel="icon" href="../../../images/favicon.png">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://xmpro.visualstudio.com/XMPro%20Development/_git/xmpro-development?path=public-documentation/docs/blocks-toolbox/advanced/metablock.md&amp;version=GB20290-migrate-public-docs&amp;line=1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../images/logo-light.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="metablock">Metablock</h1>

<p>Metablock allows pro-code designers to leverage libraries to add their dynamic blocks in XMPro using script files.</p>
<p>We recommend leveraging generative AI to write the scripts. This approach can significantly streamline the development process and enhance the functionality of the blocks.</p>
<div class="NOTE">
<h5>Note</h5>
<p>Only the <a href="metablock.html#presentation-file-html">Presentation File (HTML)</a> is required. Utilize the other properties based on your specific needs for the Metablock behavior.</p>
</div>
<h2 id="metablock-properties">Metablock Properties</h2>
<h3 id="behavior">Behavior</h3>
<h4 id="presentation-file-html">Presentation File (HTML)</h4>
<p>Upload the HTML script file that will be rendered in your Metablock, which is used to create dynamic blocks that may display data from a <a href="metablock.html#data-source">Data Source</a> or from <a href="metablock.html#value-mapping-optional">Value Mapping</a>.</p>
<pre><code class="lang-html">&lt;div class=&quot;foo&quot;&gt;bar&lt;/div&gt;
</code></pre>
<p>Alternatively, you can write your scripts in a single HTML file that includes both CSS and JavaScript. This approach is ideal for smaller applications.</p>
<pre><code class="lang-html">&lt;!-- Style with CSS the div element with class foo the color blue --&gt;
&lt;style&gt;
    .foo { color: blue }
&lt;/style&gt;

&lt;!-- Html to show the text &quot;foo&quot; --&gt;
&lt;div class=&quot;foo&quot;&gt;foo&lt;/div&gt;

&lt;!-- JavaScript to change the text &quot;foo&quot; to &quot;bar&quot; when the page has loaded --&gt;
&lt;script&gt;
    document.addEventListener('DOMContentLoaded', function() {
        const fooDiv = document.querySelector('.foo');
        fooDiv.innerHTML = 'bar';
    });
&lt;/script&gt;
</code></pre>
<h4 id="styling-file-css">Styling File (CSS)</h4>
<p>If you wish to add styling, upload a CSS file to style your Metablock control.</p>
<pre><code class="lang-css">.foo {
    color : green;
}
</code></pre>
<h4 id="script-file-javascript">Script File (JavaScript)</h4>
<p>If you wish to run JavaScript, upload a JavaScript file for your Metablock. Place any initial/startup values as constants in this file.</p>
<pre><code class="lang-javascript">const foo = 'foo';
</code></pre>
<h3 id="data-source">Data Source</h3>
<h4 id="common-properties">Common Properties</h4>
<p>Common properties include: <em>filter, sort, show # of results,</em> and <em>skip # of results</em>;</p>
<p><a href="../common-properties.html#data-source">See the Common Properties article for more details on common Data Source properties.</a></p>
<p>To use the Data Source property, include these predefined JavaScript functions in your <a href="metablock.html#script-file-javascript-optional">Script File</a>:</p>
<pre class="language-javascript"><code class="lang-javascript"><strong>// Access data source when the metablcok is loaded (optional) 
</strong><strong>function onDataLoaded(data){
</strong>  //Access a value from the data source
  const foo = data.find(obj => 'foo' in obj).foo;
}

// Access live updates on the data source after the metablock has been loaded (optional)
function onDataChanged(data, changes){
  
}
</code></pre>
<details>
<summary><code>onDataLoaded(data)</code> sample data format</summary>
<pre><code class="lang-json">[
    {
        &quot;ReadingNo&quot;: 911,
        &quot;Timestamp&quot;: &quot;2024-08-16T07:24:00.1791525Z&quot;,
        &quot;value&quot;: 3.6695501388374483,
        &quot;entityid&quot;: &quot;static&quot;,
        &quot;_$parentProperties&quot;: {},
        &quot;_$parentExpressions&quot;: [],
        &quot;_$state&quot;: {
            &quot;_$typeName&quot;: &quot;EntityState&quot;,
            &quot;name&quot;: &quot;Unchanged&quot;
        }
    }
]
</code></pre>
<p>The data above originates from a data stream that we’ve set up and it runs once upon page load. Keep in mind that the data format might differ based on your data source configuration.</p>
</details>
<details>
<summary><code>onDataChanged(data, changes)</code> sample data format</summary>
<pre><code class="lang-json">//data from `data` variable
[
    {
        &quot;ReadingNo&quot;: 1156,
        &quot;Timestamp&quot;: &quot;2024-08-16T08:04:52.3154712Z&quot;,
        &quot;value&quot;: 1.5450710600917559,
        &quot;entityid&quot;: &quot;static&quot;,
        &quot;_$parentProperties&quot;: {},
        &quot;_$parentExpressions&quot;: [],
        &quot;_$state&quot;: {
            &quot;_$typeName&quot;: &quot;EntityState&quot;,
            &quot;name&quot;: &quot;Unchanged&quot;
        }
    }
]
</code></pre>
<pre><code class="lang-json">//data from `changes` variable
[
    {
        &quot;ReadingNo&quot;: 1156,
        &quot;Timestamp&quot;: &quot;2024-08-16T08:04:52.3154712Z&quot;,
        &quot;value&quot;: 1.5450710600917559,
        &quot;entityid&quot;: &quot;static&quot;,
        &quot;_$parentProperties&quot;: {},
        &quot;_$parentExpressions&quot;: [],
        &quot;_$state&quot;: {
            &quot;_$typeName&quot;: &quot;EntityState&quot;,
            &quot;name&quot;: &quot;Unchanged&quot;
        }
    }
]
</code></pre>
<p>In this example, both the <code>data</code> and <code>changes</code> variables contain identical data, indicating that there are no updates. However, in a real-world scenario, the <code>changes</code> variable would capture any modifications to the initial data.</p>
</details>
<p><em>You can refer to a working example script that demonstrates an Autodesk Forge visualization</em> <a href="metablock.html#example-files"><em>here</em></a><em>.</em></p>
<h3 id="value">Value</h3>
<h4 id="value-mapping">Value Mapping</h4>
<p>If you wish to define value mappings for run-time use, you can configure user-defined key-value pairs. These values remain static during application rendering.</p>
<p>The Value Mapping opens a new blade to setup the Key and Value configuration. The options for the Value Source are Static, <a href="../../how-tos/apps/use-dynamic-properties.html">Dynamic</a>, <a href="../../how-tos/apps/use-expression-properties.html">Expression</a> and <a href="../../concepts/variable.html">Variables</a>.</p>
<p>When selecting Server Variables as a Source for the Value Mapping, the list of unencrypted Server Variables will be displayed. Tick the <strong>Encrypt</strong> checkbox to use an encrypted Server Variable for values like keys, secrets, or password.</p>
<p>Encrypted Server Variables will not have their value available immediately on the Metablock. Instead, you can use them inside a Fetch/XHR request or a Websocket/MQTT message before being forwarded to the actual target.</p>
<ul>
<li><strong>Fetch/XHR Request -</strong> You can use encrypted server variables as part of the URL, Header, or Body of the Fetch/XHR request.</li>
<li><strong>Websocket/MQTT Message -</strong> You can use encrypted server variables as part of the Websocket message. For MQTT Messages, you can use it as part of the following message types: Connect (Username and Password), Publish (Payload), and Subscribe (Subscribe Topics)</li>
</ul>
<h4 id="proxy-requests">Proxy Requests</h4>
<p>Tick to proxy requests on the AD Server before being forwarded to the actual request. This is ticked by default when using an encrypted server variable on the value mapping, but you can opt in to use it even without any encrypted server variable.</p>
<p>To use Value Mapping, include this predefined JavaScript function in your <a href="metablock.html#script-file-javascript-optional">Script File</a>:</p>
<pre><code class="lang-javascript">// Access Value mapping data when the metablock is loaded (optional)
function onValueMappingLoaded(data){
    //Apply a value from the value mapping
    const foo = data['foo'];
}
</code></pre>
<details>
<summary><code>OnValueMappingLoaded(data)</code> sample data format</summary>
<pre><code class="lang-json">  {
      &quot;key&quot;: &quot;Value&quot;,
      &quot;isWorking&quot;: true,
      &quot;counter&quot;: 10
      &quot;password&quot;: &quot;{{var-x:Encrypted Variable Name}}&quot; //Encrypted Server Variable template
  }
</code></pre>
</details>
<div class="WARNING">
<h5>Warning</h5>
<p>Note: The password property will not have the actual value yet when it is mapped from an Encrypted Server Variable. Instead, it is just a template for the Server Variable name.</p>
</div>
<h2 id="real-world-use-cases"><strong>Real World Use Cases</strong></h2>
<h3 id="enhancing-chart-display">Enhancing Chart Display</h3>
<p>Use Value Mapping to incorporate user input for displaying Harmonic Frequency, maintaining connector integrity while improving data visualization.</p>
<p>![Fig 1: Enhancing chart display](..\images\Metablock - Enhance Chart Display.png)</p>
<p><a href="https://github.com/XMPro/meta-block-examples/tree/main/src/packages/chart-display">Link to resource</a></p>
<div class="WARNING">
<h5>Warning</h5>
<p><strong>Note:</strong> Displaying the Metablock may take some time since it needs to finish loading all referenced App File resources before it is shown on the Application. Avoid referencing heavy files from the App Files and use external resources instead.</p>
</div>
<p>You can also dynamically load JavaScript files but only for external resources and not from the App Files.</p>
<pre><code class="lang-javascript">function loadScript(url) {
    return new Promise((resolve, reject) =&gt; {
        const script = document.createElement('script');
        script.src = url;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
    });
}
</code></pre>
<h3 id="why-is-the-metablock-throwing-500-errors-related-to-styling-and-script-files">Why is the Metablock throwing 500 errors related to styling and script files?</h3>
<p>This can occur if your HTML file includes inline script import code that does not follow the correct format. Only link external resources or make sure the file is uploaded on <strong>App Files</strong> and the URL format is correct.</p>
<pre><code class="lang-html">&lt;!-- unsupported import script --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;

&lt;!-- unsupported import script --&gt;
&lt;script src=&quot;app.js&quot;&gt;&lt;/script&gt;

&lt;!-- valid html --&gt;
&lt;span&gt;foo&lt;/span&gt;   
</code></pre>

</article>


        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Copyright © 2025 XMPro. All rights reserved.
        </div>
      </div>
    </footer>
  </body>
</html>
